{"ts":1341021619532,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"//user vars\nvar pos = -1;\n\n//stream vars\nvar lastChat = -1;\nvar lastSentiment = -1;\n\n//sentiment buffer\nvar sentimentBuffer = [];\n\n//chat buffer\nvar chatBuffer = [];\n\n//table \nvar table;\n\n//circles\nvar circles = [];\n\n//first time stamp\nvar firstTS = undefined;\n\n//starting x coord for the linear viz \nvar startx = 0;\n\n//number of pixels representing 1 second in the linear viz\nvar pixps = 5;\n\n//options\nvar bg = 'white';\nvar type = 'splatters';\nvar ltype = 'order';\n\n//reset\nvar resetable = false;\n\n$(document).ready(function(){\n    //hide new user window\n    $('#adduser').hide();\n    //hide options\n    $('#options').hide();\n    \n    //send button\n    $('#btn').click(function(){\n        if(pos>=0 && pos<=3){\n            sendMessage($('#inp').val());\n        } else {\n            alert(\"click on a position to join the conversation\");\n        }\n        $('#inp').val('');\n    });\n    //cancel\n    $('#cancel').click(function(){\n        pos = -1;\n        $('#username').val('');\n        $('#color').val('');\n        $('#adduser').hide();\n    });\n    //add user \n    $('#blue').click(function(){\n        if($('#username').val() !== undefined){\n            addUser($('#username').val(),1);\n            $('#adduser').hide();\n        } else {\n            pos = -1;\n        }\n    });\n    $('#orange').click(function(){\n        if($('#username').val() !== undefined){\n            addUser($('#username').val(),2);\n            $('#adduser').hide();\n        } else {\n            pos = -1;\n        }\n    });\n    $('#violet').click(function(){\n        if($('#username').val() !== undefined){\n            addUser($('#username').val(),3);\n            $('#adduser').hide();\n        } else {\n            pos = -1;\n        }\n    });\n    $('#green').click(function(){\n        if($('#username').val() !== undefined){\n            addUser($('#username').val(),4);\n            $('#adduser').hide();\n        } else {\n            pos = -1;\n        }\n    });\n    \n    //options\n    $(\".inline\").colorbox({inline:true, width:\"30%\"});\n    $('#bg').change(function(){\n        changeTheme($('#bg').val());\n    });\n    $('#viztype').change(function(){\n        type = $('#viztype').val(); \n    });\n    $('#linviztype').change(function(){\n        ltype = $('#linviztype').val(); \n    });\n    $('#senti').change(function(){\n        changeSenti($('#senti').val());\n    });\n    \n    //reset\n    $('#reset').click(function(){\n        $.ajax({url:'/reset'});\n    });\n    \n    //unload\n    $(window).unload(function(){\n        removeUser();\n    });\n});\n\nfunction changeTheme(color){\n    bg = color;\n    if(color == 'white'){\n        //make everything else black\n        $('#adduser').css('background-color','#000000');\n        $('#adduser').css('color','#ffffff');\n        \n    } else {\n        //make everything else white\n        $('#adduser').css('background-color','#ffffff');\n        $('#adduser').css('color','#000000');\n    }\n    \n}\n\nfunction changeSenti(source){\n    if(source == 'swn'){\n        $.ajax({\n            type: 'POST',\n            url: '/swn?val=true'\n        });\n    } else {\n        $.ajax({\n            type: 'POST',\n            url: '/swn?val=false'\n        });\n    }\n}\n\nfunction update(){\n    //updateChat(); this is now done from linear.pde\n    updateTable();\n    //updateCircles(); //circles doesn't work\n    updateBuffer();\n}\n\nfunction updateChat(){\n    $.ajax({\n        url: '/stream?last='+lastChat,\n        success: function(data){\n            var content = $('#output').html();\n            for(var i in data){\n                if(data[i].index > lastChat){\n                    if(firstTS === undefined){\n                        firstTS = parseInt(data[i].time,10);\n                    }\n                    chatBuffer.push(data[i]);\n                    lastChat = data[i].index;\n                    content += '<p><span style=\"color:' + data[i].color +'\">' + \n                    data[i].name + ':</span>' + data[i].text + '</p>';\n                }\n            }\n            $('#output').html(content);\n        } \n    });\n}\n\nfunction updateTable(){\n    $.ajax({\n        url: '/table',\n        success: function(data){\n            table = data;\n        }\n    });\n}\n\nfunction updateCircles(){\n    $.ajax({\n        url: '/circles',\n        success: function(data){\n            circles = data;\n        }\n    });\n}\n\nfunction updateBuffer(){\n    $.ajax({\n        url: '/sentiments?last='+lastSentiment,\n        success: function(data){\n            for(var i in data){\n                if(data[i].index > lastSentiment){\n                    lastSentiment = data[i].index;\n                    sentimentBuffer.push(data[i]);\n                }\n            }\n        }\n    });\n}\n\nfunction addUser(name,theme){\n    $.ajax({\n        type: 'POST',\n        url: '/user?pos='+pos+'&name='+encodeURIComponent(name) + \n             '&theme='+encodeURIComponent(theme)\n    });\n}\n\nfunction removeUser(){\n    $.ajax({\n        type: 'DELETE',\n        url: '/user?pos='+pos\n    });\n}\n\nfunction sendMessage(text){\n    $.ajax({\n        type: 'POST',\n        url: '/chat?pos='+pos+'&text='+encodeURIComponent(text)\n    });\n}\n\n//resets the client\nfunction resetClient(){\n    if(resetable){\n        pos = -1;   \n        lastChat = -1;\n        lastSentiment = -1;\n        sentimentBuffer = [];\n        chatBuffer = [];\n        circles = [];\n        firstTS = undefined;\n        startx = 0;\n        resetable = false;\n    }\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":5391}]],"length":5391}
